/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var f=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var w=Object.prototype.hasOwnProperty;var P=(i,r)=>{for(var a in r)f(i,a,{get:r[a],enumerable:!0})},E=(i,r,a,e)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of S(r))!w.call(i,t)&&t!==a&&f(i,t,{get:()=>r[t],enumerable:!(e=F(r,t))||e.enumerable});return i};var y=i=>E(f({},"__esModule",{value:!0}),i);var v={};P(v,{default:()=>u});module.exports=y(v);var m=require("obsidian");var l=require("@codemirror/state"),o=require("@codemirror/view");var c=(i,r)=>{let a=r.app.metadataCache.getCache(i),e=a==null?void 0:a.frontmatter;if(!e)return;let t=r.settings.imageKeys.map(d=>e[d]).find(d=>!!d);if(!t)return;let n=t.match(/^\[\[([^|\]]+)(?:\|[^\]]+)?\]\]$/);if(n&&(t=n[1]),t.startsWith("http")||t.startsWith("/")||t.startsWith("data:"))return t;let s=r.app.metadataCache.getFirstLinkpathDest(t,i);return s?r.app.vault.getResourcePath(s):t},g=i=>{let r=document.createElement("img");return r.src=i,r.classList.add("frontmatter-image"),r};var h=i=>{let r=()=>{let e=o.EditorView.findFromDOM(document.body);return(e==null?void 0:e.contentDOM.closest(".is-live-preview"))!==null},a=(e,t)=>{if(!t)return o.Decoration.none;let n=new l.RangeSetBuilder;return n.add(e.end.offset+1,e.end.offset+1,o.Decoration.widget({widget:new class extends o.WidgetType{toDOM(s){return g(t)}}})),n.finish()};return l.StateField.define({create:e=>{var n;let t=(n=i.app.workspace.activeEditor)==null?void 0:n.file;if(t)return{activeFile:t,decorationSet:void 0}},update:(e,t)=>{if(!e)return;if(!r())return{...e,decorationSet:void 0};let n=i.app.metadataCache.getFileCache(e.activeFile),s=n==null?void 0:n.frontmatterPosition;if(!s)return{...e,decorationSet:void 0};let d=c(e.activeFile.path,i);return{...e,decorationSet:a(s,d)}},provide:e=>o.EditorView.decorations.from(e,t=>{var n;return(n=t==null?void 0:t.decorationSet)!=null?n:o.Decoration.none})})};var I={imageKeys:[]},u=class extends m.Plugin{async onload(){await this.loadSettings(),this.addSettingTab(new p(this.app,this)),this.registerEditorExtension(h(this)),this.registerMarkdownPostProcessor((a,e)=>{if(!a.hasClass("mod-frontmatter"))return;let t=c(e.sourcePath,this);if(!t)return;let n=document.createElement("div"),s=g(t);n.appendChild(s);let d=document.createElement("br");n.appendChild(d),a.appendChild(n)})}onunload(){}async loadSettings(){this.settings=Object.assign({},I,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},p=class extends m.PluginSettingTab{constructor(a,e){super(a,e);this.plugin=e}display(){let{containerEl:a}=this;a.empty(),new m.Setting(a).setName("YAML keys").setDesc("Frontmatter keys that contain image source; one per line. Only the first populated key's image will be rendered.").addTextArea(e=>e.setPlaceholder("Enter your keys").setValue(this.plugin.settings.imageKeys.join(`
`)).onChange(async t=>{this.plugin.settings.imageKeys=t.split(`
`).map(n=>n.trim()).filter(n=>n.length>0),await this.plugin.saveSettings()}))}};
