/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var x=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var W=Object.prototype.hasOwnProperty;var _=(g,t)=>{for(var e in t)x(g,e,{get:t[e],enumerable:!0})},A=(g,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of D(t))!W.call(g,i)&&i!==e&&x(g,i,{get:()=>t[i],enumerable:!(n=R(t,i))||n.enumerable});return g};var O=g=>A(x({},"__esModule",{value:!0}),g);var q={};_(q,{default:()=>T});module.exports=O(q);var E=require("obsidian");var p=require("obsidian");var P={enableCycling:!0,showGutterBadges:!0,wrapAfterH6:!0,minLevel:1,maxLevel:6,badgeBackgroundColor:"#3b82f6",badgeTextColor:"#ffffff",checkHierarchy:!0,allowHierarchyOverride:!1},b=class extends p.PluginSettingTab{constructor(e,n){super(e,n);this.plugin=n}display(){let{containerEl:e}=this;e.empty(),this.addHeadingSettings(e),this.addGutterSettings(e),this.addHierarchySettings(e),this.addHelpSection(e)}addHeadingSettings(e){new p.Setting(e).setName("Enable heading cycling").setDesc("Allow cycling through heading levels with commands").addToggle(n=>n.setValue(this.plugin.settings.enableCycling).onChange(async i=>{this.plugin.settings.enableCycling=i,await this.plugin.saveSettings()})),new p.Setting(e).setName("Wrap after H6").setDesc("Allow H6 to demote to paragraph. If disabled, H6 will remain H6 when demoted.").addToggle(n=>n.setValue(this.plugin.settings.wrapAfterH6).onChange(async i=>{this.plugin.settings.wrapAfterH6=i,await this.plugin.saveSettings()})),new p.Setting(e).setName("Minimum heading level").setDesc("The minimum heading level for cycling operations").addDropdown(n=>{for(let i=1;i<=6;i++)n.addOption(i.toString(),`H${i}`);return n.setValue(this.plugin.settings.minLevel.toString()).onChange(async i=>{this.plugin.settings.minLevel=parseInt(i),await this.plugin.saveSettings()})}),new p.Setting(e).setName("Maximum heading level").setDesc("The maximum heading level for cycling operations").addDropdown(n=>{for(let i=1;i<=6;i++)n.addOption(i.toString(),`H${i}`);return n.setValue(this.plugin.settings.maxLevel.toString()).onChange(async i=>{this.plugin.settings.maxLevel=parseInt(i),await this.plugin.saveSettings()})})}addGutterSettings(e){new p.Setting(e).setName("Show gutter badges").setDesc("Display heading level indicators in the editor gutter").addToggle(n=>n.setValue(this.plugin.settings.showGutterBadges).onChange(async i=>{this.plugin.settings.showGutterBadges=i,await this.plugin.saveSettings()})),new p.Setting(e).setName("Badge background color").setDesc("Background color for the gutter badges").addColorPicker(n=>n.setValue(this.plugin.settings.badgeBackgroundColor).onChange(async i=>{this.plugin.settings.badgeBackgroundColor=i,await this.plugin.saveSettings()})),new p.Setting(e).setName("Badge text color").setDesc("Text color for the gutter badges").addColorPicker(n=>n.setValue(this.plugin.settings.badgeTextColor).onChange(async i=>{this.plugin.settings.badgeTextColor=i,await this.plugin.saveSettings()}))}addHierarchySettings(e){new p.Setting(e).setName("Check heading hierarchy").setDesc("Show warnings when heading structure might be problematic").addToggle(n=>n.setValue(this.plugin.settings.checkHierarchy).onChange(async i=>{this.plugin.settings.checkHierarchy=i,await this.plugin.saveSettings()})),new p.Setting(e).setName("Allow hierarchy override").setDesc("Allow operations to proceed even when hierarchy issues are detected").addToggle(n=>n.setValue(this.plugin.settings.allowHierarchyOverride).onChange(async i=>{this.plugin.settings.allowHierarchyOverride=i,await this.plugin.saveSettings()}))}addHelpSection(e){let n=e.createEl("div",{cls:"setting-item-description"});n.createEl("hr"),n.createEl("h4",{text:"Usage tips"}).addClass("heading-helper-help-heading");let r=n.createEl("p");r.createEl("span",{text:"Configure hotkeys for all commands in Obsidian's main settings under "}),r.createEl("strong",{text:"Hotkeys"}),r.createEl("span",{text:' (search for "Heading helper").'}),n.createEl("p").createEl("span",{text:"Click on gutter badges (if enabled) to change heading levels directly with your mouse."})}};var N=require("obsidian");var c=class{static parseLine(t){let e=t.match(this.LINE_PATTERN);if(!e)return{indent:"",listMarker:"",headingMarker:"",content:t,level:0};if(e[3]&&e[3].length>6)return{indent:"",listMarker:"",headingMarker:"",content:t,level:0};let[,n="",i="",r="",a=""]=e,s=r?r.length:0;return{indent:n,listMarker:i,headingMarker:r,content:a.trim(),level:s}}static lineToText(t,e){let n=e===0?"":"#".repeat(e)+" ";return`${t.indent}${t.listMarker}${n}${t.content}`}static cycleHeading(t,e,n=!0){if(t===0)return 0;switch(e){case"up":return t===1?1:t-1;case"down":return t===6?n?0:6:t+1;case"cycle":return t===6?n?0:6:t+1;default:return t}}static getHeadingDisplayText(t){return t!==0?`H${t}`:""}static getHeadingTooltip(t){return t===0?"Paragraph \u2013 click to change":`Heading ${t} \u2013 click to change`}};c.LINE_PATTERN=/^(\s*)([-*+]\s+)?(?:(#+)(?=\s))?\s*(.*?)$/;var M=require("obsidian");var y=class{constructor(t){this.settings=t;this.lastWarningTime=0;this.lastWarningType="";this.DEBOUNCE_TIME=1500}async checkAndWarnHierarchy(t,e,n,i,r,a){if(!this.settings.checkHierarchy){a();return}let s=this.checkHierarchy(e,n,i,r);if(!s){a();return}if(this.isRecentDuplicate(s,r)){if(this.shouldBlockOperation(s.type))return;a();return}this.updateLastWarning(s,r),new M.Notice(s.message,5e3),!this.shouldBlockOperation(s.type)&&a()}isRecentDuplicate(t,e){let n=Date.now(),i=`${t.type}-${t.currentLevel}-${t.targetLevel}-${e}`;return n-this.lastWarningTime<this.DEBOUNCE_TIME&&this.lastWarningType===i}updateLastWarning(t,e){this.lastWarningTime=Date.now(),this.lastWarningType=`${t.type}-${t.currentLevel}-${t.targetLevel}-${e}`}shouldBlockOperation(t){return["hierarchy_break","demotion_blocked","promotion_blocked"].includes(t)&&!this.settings.allowHierarchyOverride}getHeadingLinesFromSelection(t,e){let n=t.listSelections(),i=[];if(n.length===0)return i;let r=n[0],a=Math.min(r.anchor.line,r.head.line),s=Math.max(r.anchor.line,r.head.line);for(let o=a;o<=s;o++){if(e!==void 0&&o===e-1)continue;let l=t.getLine(o),d=c.parseLine(l);(d==null?void 0:d.level)!==0&&i.push({level:d.level,lineNumber:o+1})}return i}checkHierarchy(t,e,n,i){if(e===n)return null;let r=n<e,a=n>e,s=this.getHeadingLinesFromSelection(t),o=this.getHeadingLinesFromSelection(t,i),l=this.getLevelsSet(s),d=this.getLevelsSet(o);return r?this.checkPromotionRules(e,n,i,d):a?this.checkDemotionRules(e,n,i,l):null}checkPromotionRules(t,e,n,i){return e===1&&t!==1&&i.has(1)?{type:"hierarchy_break",currentLevel:t,targetLevel:e,lineNumber:n,message:"Warning: The current selection contains both H1 and H2 headings. Promoting headings within this selection might affect overall document structure. Please review."}:null}checkDemotionRules(t,e,n,i){return t===5&&e===6&&!this.settings.wrapAfterH6&&i.has(6)?{type:"demotion_blocked",currentLevel:t,targetLevel:e,lineNumber:n,message:'Demoting H5 to H6: "Wrap after H6" is disabled, and both H5 and H6 levels exist globally. This can create a dead-end. Consider enabling "Wrap after H6".'}:this.settings.wrapAfterH6&&t===6?{type:"general_warning",currentLevel:t,targetLevel:e,lineNumber:n,message:'Reminder: "Wrap after H6" is enabled. Repeatedly demoting H6 will eventually convert them to Paragraphs. The document contains both H5 and H6 levels.'}:t===6&&e===0&&!this.settings.wrapAfterH6?{type:"demotion_blocked",currentLevel:t,targetLevel:6,lineNumber:n,message:'Cannot demote H6 to paragraph: "Wrap after H6" is disabled. enable this setting to allow conversion to paragraph.'}:this.settings.wrapAfterH6&&e===0&&t>=1&&t<=5&&i.has(6)?{type:"hierarchy_break",currentLevel:t,targetLevel:e,lineNumber:n,message:`Converting ${this.levelToString(t)} to Paragraph might orphan existing lower-level headings (e.g., ${this.levelToString(t+1)}). Review structure.`}:null}getLevelsSet(t){return new Set(t.map(e=>e.level))}levelToString(t){return t===0?"Paragraph":`H${t}`}};var H=class{constructor(t,e){this.settings=t;this.app=e;this.hierarchyChecker=new y(t)}async cycleHeading(t,e="cycle"){if(!this.settings.enableCycling)return;let n=t.listSelections();for(let i of n)await this.processSelection(t,i,e)}async setHeadingLevel(t,e,n){if(n!==void 0)await this.setSpecificLine(t,e,n);else{let i=t.listSelections();for(let r of i)await this.processSelectionWithLevel(t,r,e)}}async setSpecificLine(t,e,n){let i=t.getLine(n-1),r=c.parseLine(i),a=r.level!==0,s=e===0&&r.level===6;(a||s)&&(this.app?await this.hierarchyChecker.checkAndWarnHierarchy(this.app,t,r.level,e,n,()=>this.transformLine(t,n-1,e)):this.transformLine(t,n-1,e))}async processSelection(t,e,n){let{anchor:i,head:r}=e,a=Math.min(i.line,r.line),s=Math.max(i.line,r.line),o=[];for(let l=a;l<=s;l++){let d=t.getLine(l),h=c.parseLine(d);if(h.level!==0){let S=c.cycleHeading(h.level,n,this.settings.wrapAfterH6),f=this.applyLevelConstraints(S);f!==h.level&&o.push({lineNum:l,currentLevel:h.level,targetLevel:f})}}await this.executeBatchTransformation(t,o,n,a,s)}async processSelectionWithLevel(t,e,n){let{anchor:i,head:r}=e,a=Math.min(i.line,r.line),s=Math.max(i.line,r.line),o=[];for(let l=a;l<=s;l++){let d=t.getLine(l),h=c.parseLine(d),S=h.level!==0,f=n===0&&h.level===6;(S||f)&&h.level!==n&&o.push({lineNum:l,currentLevel:h.level,targetLevel:n})}await this.executeBatchTransformation(t,o,"set",a,s)}async executeBatchTransformation(t,e,n,i,r){if(e.length===0)return;let a=e.map(o=>({lineNum:o.lineNum,originalText:t.getLine(o.lineNum),originalLevel:o.currentLevel})),s=this.buildOriginalLevelsMap(t,i,r,a);for(let o of e)this.transformLine(t,o.lineNum,o.targetLevel);if(this.app&&e.length>0&&this.settings.checkHierarchy&&!await this.checkBatchHierarchy(t,e,s,n,i,r))for(let l of a)t.replaceRange(l.originalText,{line:l.lineNum,ch:0},{line:l.lineNum,ch:t.getLine(l.lineNum).length})}buildOriginalLevelsMap(t,e,n,i){let r=new Map;for(let a=e;a<=n;a++){let s=i.find(o=>o.lineNum===a);if(s)r.set(a,s.originalLevel);else{let o=t.getLine(a),l=c.parseLine(o);r.set(a,l.level)}}return r}async checkBatchHierarchy(t,e,n,i,r,a){let s=this.analyzeBatchTransformation(t,e,n,r,a);if(s.length===0)return!0;let o=s[0],l=this.findRepresentativeTransformation(e,o),d=this.buildWarningDetails(o,l);return new N.Notice(d.message,5e3),i==="set"?!0:!["hierarchy_break","demotion_blocked","promotion_blocked"].includes(d.type)||this.settings.allowHierarchyOverride}findRepresentativeTransformation(t,e){return t.find(n=>n.lineNum===(e.lineNumber?e.lineNumber-1:-1))||t.find(n=>n.currentLevel===e.currentLevel&&n.targetLevel===e.targetLevel)||t[0]}buildWarningDetails(t,e){var n,i,r;return{type:t.type,currentLevel:(n=t.currentLevel)!=null?n:e.currentLevel,targetLevel:(i=t.targetLevel)!=null?i:e.targetLevel,lineNumber:(r=t.lineNumber)!=null?r:e?e.lineNum+1:0,message:t.message}}analyzeBatchTransformation(t,e,n,i,r){let a=[];if(e.length===0)return a;let s=Math.min(...e.map(d=>d.lineNum)),o=Math.max(...e.map(d=>d.lineNum)),l=this.getHeadingLevelsInRange(t,s,o);return this.checkCriticalBlocks(e,n,i,r,a),this.checkGeneralWarnings(e,l,a),this.deduplicateIssues(a)}checkCriticalBlocks(t,e,n,i,r){t.forEach(s=>{s.currentLevel===6&&s.targetLevel===0&&!this.settings.wrapAfterH6&&r.push({type:"demotion_blocked",message:'Cannot demote H6 to paragraph: "Wrap after H6" is disabled.',currentLevel:s.currentLevel,targetLevel:s.targetLevel,lineNumber:s.lineNum+1})});let a=t.filter(s=>s.targetLevel===1&&s.currentLevel>1);if(a.length>0){let s=!1;for(let o=n;o<=i;o++)if(!a.some(d=>d.lineNum===o)&&e.get(o)===1){s=!0;break}s&&a.forEach(o=>{r.push({type:"promotion_blocked",message:"Cannot promote to H1: An H1 heading already existed within the original selection.",currentLevel:o.currentLevel,targetLevel:o.targetLevel,lineNumber:o.lineNum+1})})}if(!this.settings.wrapAfterH6){let s=t.filter(o=>o.currentLevel===5&&o.targetLevel===6);if(s.length>0){let o=!1;for(let l=n;l<=i;l++)if(!s.some(h=>h.lineNum===l)&&e.get(l)===6){o=!0;break}o&&s.forEach(l=>{r.push({type:"demotion_blocked",message:'Cannot demote H5 to H6: an H6 already existed in the original selection, and "Wrap after H6" is disabled.',currentLevel:l.currentLevel,targetLevel:l.targetLevel,lineNumber:l.lineNum+1})})}}}checkGeneralWarnings(t,e,n){let i=n.some(a=>a.type==="promotion_blocked"&&a.targetLevel===1),r=n.some(a=>a.type==="demotion_blocked"&&(a.targetLevel===6||a.currentLevel===6));if(!i&&e.has(1)&&e.has(2)){let a=t.find(s=>s.targetLevel===1||s.targetLevel===2)||t[0];n.push({type:"general_warning",message:"Warning: The selection now contains both H1 and H2 headings. This might affect document structure.",currentLevel:a==null?void 0:a.currentLevel,targetLevel:a==null?void 0:a.targetLevel,lineNumber:a?a.lineNum+1:void 0})}if(!r&&!this.settings.wrapAfterH6&&e.has(5)&&e.has(6)){let a=t.find(s=>s.targetLevel===5||s.targetLevel===6)||t[0];n.push({type:"general_warning",message:'Warning: Selection now contains H5 and H6 headings, and "Wrap after H6" is disabled. This may lead to H6 dead-ends.',currentLevel:a==null?void 0:a.currentLevel,targetLevel:a==null?void 0:a.targetLevel,lineNumber:a?a.lineNum+1:void 0})}}deduplicateIssues(t){let e=[],n=new Set;for(let i of t){let r=i.lineNumber?`${i.lineNumber}-${i.message}`:i.message;n.has(r)||(e.push(i),n.add(r))}return e}getHeadingLevelsInRange(t,e,n){let i=new Set;for(let r=e;r<=n;r++){let a=t.getLine(r),s=c.parseLine(a);s.level!==0&&i.add(s.level)}return i}countHeadingLevelInRange(t,e,n,i,r=[]){let a=0;for(let s=n;s<=i;s++){if(r.includes(s))continue;let o=t.getLine(s);c.parseLine(o).level===e&&a++}return a}getLineInfo(t){let e=t.lineCount(),n=[];for(let i=0;i<e;i++){let r=t.getLine(i),a=c.parseLine(r);(r.trim()!==""||a.level!==0)&&n.push({lineNumber:i+1,text:r,headingLevel:a.level,indent:a.indent,listMarker:a.listMarker,headingMarker:a.headingMarker,content:a.content})}return n}batchTransform(t,e,n){let i=[...e].sort((r,a)=>a-r);for(let r of i)this.transformLine(t,r-1,n)}smartPromote(t){this.cycleHeading(t,"up")}smartDemote(t){this.cycleHeading(t,"down")}transformLine(t,e,n){let i=t.getLine(e),r=c.parseLine(i),a=c.lineToText(r,n),s={line:e,ch:0},o={line:e,ch:i.length};t.replaceRange(a,s,o)}applyLevelConstraints(t){return t===0?t:t<this.settings.minLevel?this.settings.minLevel:t>this.settings.maxLevel?this.settings.maxLevel:t}getHeadingLevel(t,e){let n=t.getLine(e);return c.parseLine(n).level}};var m=require("@codemirror/view"),u=require("@codemirror/state"),B=require("obsidian");var w="cm-heading-helper-marker",$="cm-heading-helper-gutter",L=class extends m.GutterMarker{constructor(e,n,i,r,a){super();this.view=e;this.headingLevel=n;this.lineNumber=i;this.settings=r;this.onLevelChange=a}toDOM(){let e=document.createElement("div");return e.className=w,e.dataset.level=String(this.headingLevel),e.title=c.getHeadingTooltip(this.headingLevel),e}eq(e){return e instanceof L&&e.headingLevel===this.headingLevel&&e.lineNumber===this.lineNumber}},C=class{constructor(t,e,n){this.settings=e;this.onLevelChange=n;this.view=t,this.markers=this.buildMarkers(t)}buildMarkers(t){if(!this.settings.showGutterBadges)return u.RangeSet.empty;let e=new u.RangeSetBuilder,n=t.state.doc;for(let i=1;i<=n.lines;i++){let r=n.line(i),a=c.parseLine(r.text);if(a.level!==0){let s=new L(t,a.level,i,this.settings,this.onLevelChange);e.add(r.from,r.from,s)}}return e.finish()}update(t){(t.docChanged||t.viewportChanged)&&(this.markers=this.buildMarkers(this.view))}};function V(g){return{click:(t,e,n)=>{let i=n.target;if(!(i!=null&&i.classList.contains(w))||i.classList.contains("has-active-menu"))return(i==null?void 0:i.classList.contains(w))||!1;if(!i.dataset.level)return!1;let s=t.state.doc.lineAt(e.from).number;return G(i,s,g),!0},mousedown:(t,e,n)=>{let i=n.target;return(i==null?void 0:i.classList.contains(w))||!1}}}function G(g,t,e){let n=new B.Menu;n.addItem(r=>r.setTitle("Paragraph").setIcon("type").onClick(()=>e(t,0)));for(let r=1;r<=6;r++)n.addItem(a=>a.setTitle(`Heading ${r}`).setIcon(`heading-${r}`).onClick(()=>e(t,r)));g.classList.add("has-active-menu");let i=g.getBoundingClientRect();n.showAtPosition({x:i.left,y:i.bottom+4}),setTimeout(()=>{g.classList.remove("has-active-menu")},100)}function I(g,t){let e=m.ViewPlugin.fromClass(class extends C{constructor(n){super(n,g,t)}});return[e,u.Prec.high((0,m.gutter)({class:$,markers(n){var i;return((i=n.plugin(e))==null?void 0:i.markers)||u.RangeSet.empty},domEventHandlers:V(t)}))]}var k=class{constructor(t,e){this.settings=t;this.onLevelChange=e;this.gutterExtension=I(t,e)}getExtension(){return this.gutterExtension}updateSettings(t){this.settings=t,this.gutterExtension=I(t,this.onLevelChange)}};var T=class extends E.Plugin{async onload(){await this.loadSettings(),this.initializeComponents(),this.registerCommands(),this.registerEditorExtensions(),this.addSettingTab(new b(this.app,this))}async loadSettings(){this.settings=Object.assign({},P,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.updateComponents(),this.app.workspace.updateOptions()}initializeComponents(){this.headingOps=new H(this.settings,this.app),this.badgeManager=new k(this.settings,this.handleBadgeLevelChange.bind(this))}updateComponents(){this.headingOps=new H(this.settings,this.app),this.badgeManager.updateSettings(this.settings)}registerCommands(){this.addCommand({id:"cycle-heading",name:"Cycle heading level",icon:"heading",editorCallback:e=>this.headingOps.cycleHeading(e,"cycle")}),this.addCommand({id:"heading-up",name:"Decrease heading level",icon:"chevron-up",editorCallback:e=>this.headingOps.cycleHeading(e,"up")}),this.addCommand({id:"heading-down",name:"Increase heading level",icon:"chevron-down",editorCallback:e=>this.headingOps.cycleHeading(e,"down")});for(let e=1;e<=6;e++)this.addCommand({id:`set-heading-${e}`,name:`Set as heading ${e}`,editorCallback:n=>this.headingOps.setHeadingLevel(n,e)});this.addCommand({id:"set-paragraph",name:"Set as paragraph",editorCallback:e=>this.headingOps.setHeadingLevel(e,0)})}registerEditorExtensions(){this.registerEditorExtension(this.badgeManager.getExtension())}async handleBadgeLevelChange(e,n){let i=this.app.workspace.getActiveViewOfType(E.MarkdownView);i!=null&&i.editor&&await this.headingOps.setHeadingLevel(i.editor,n,e)}getHeadingLevel(e,n){return this.headingOps.getHeadingLevel(e,n)}async setHeadingLevel(e,n,i){await this.headingOps.setHeadingLevel(e,n,i)}async cycleHeading(e,n="cycle"){await this.headingOps.cycleHeading(e,n)}};
